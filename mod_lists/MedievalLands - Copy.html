<!DOCTYPE html>
<style>


body {
	    border: 15px solid #4b4945;

		background: #4b4945;
		max-width:100%
}

span { 
   font-size: 3em; 
   display: inline-block; }

h5 {
    color: #d8d8d8;
    display: block;
    font-family: 'Roboto',sans-serif;
    font-weight: 400;
    font-size: 15px;
    letter-spacing: initial;
    line-height: 1.2;
    margin: 0 0 5px 0;
    text-shadow: 0 0 2px rgba(0,0,0,0.4);
    white-space: pre-wrap;

}

img {
	height:auto;
	max-width:100%;
	display: block;
	margin-left: auto;
	margin-right: auto;
}

p {
	color: #c4c2be;
    -webkit-box-orient: vertical;
    display: block;
    font-size: 13px;
    -webkit-line-clamp: 6;
    margin: 0;
    overflow: hidden;
    text-overflow: ellipsis;

	text-rendering: optimizeLegibility;
    line-height: 1.3;
    font-family: 'Roboto',sans-serif;
    font-weight: 300;
}

iframe {
	height:auto;
	max-width:100%;
	display: block;
	margin-left: auto;
	margin-right: auto;
}

button {
	color: #e5e4dc;
	background-color: #424242;
	font-size: 20px;
	border: 3px solid #322f2f;
	padding: 4px 100px;
	cursor: pointer
}

button:hover {
	color: #ffd22e;
	background-color: #626060;
}



.parent {
	display: grid;
	grid-gap: 5px;
	grid-template-columns: repeat(auto-fill, minmax(180px, 180px));
	max-width: 1800px;
  }
  
.child {
height: 235px;
width: 180px;
background-color: #444441;
border-style: solid;
border-color: #333231;
}

.childImageContainer {
height: 135px;
width: 100%;
}
.fill {
    background-size: cover;
    background-position: center;
    width: 100%;
    height: 100%;
}

.childTextContainer {
	margin-left: 7px;
	margin-right: 7px;
	margin-top: 5px;
	margin-bottom: 5px;
}
</style>


<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Answer</title>
</head>

<body>
    <div id="container"></div>

	<button onClick="popUp()" type="button" name="ImportThis">Import This Mod</button>

	<div class="parent" id = "parent">
		<!-- <div class="child" id = "child">
			<div class="childImageContainer">
				<div class="fill" style="background-image: url('ModThumbnailUrl');"></div>
			</div>
			<div class="childTextContainer">
				<h5>ModName</h5>
				<p>ModDescription</p>
			</div>
		</div> -->
  	</div>

</body>
</html>


<script>
	
	//unreal recognises popup opening as an event. we can use this popup's url to download and import the mod int rm.

	function popUp() { window.open(window.location.pathname,'popUp',"height=590,width=450,toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=auto,resizable=yes,copyhistory=no"); }

	let innerReturnFunction = ({res, myName}) => {
    /* this works */
    console.log(`hi from inner name: ${myName}`);
    return {res, myName}; // return an object
	}

	fetch('https://raw.githubusercontent.com/RuneMod/RuneFace/master/ModList.txt').then(function (response) {
	// The API call was successful!
	return response.text();
	}).then(function (data) {

		//document.getElementById('container').innerHTML = data;

		var modPack_json = JSON.parse(data);


		//<iframe width="854" height="480" src="https://www.youtube.com/embed/83MYRPH8X_k" title="Project RuneMod" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

		for(let i = 0; i < modPack_json.modSettings.length; i++) {
			var url = modPack_json.modSettings[i].mod_Page;

			if(url === '') {continue;} //if mod_Page url is empty, skip this mod.

			generateModPagePreview(url);
		}

	}).catch(function (err) {
		// There was an error
		console.warn('Something went wrong.', err);
	});

	async function generateModPagePreview(url) {
		
		let response = await fetch(url);
		let data = await response.text();

		//figure out the root path
		let page = url.split('/').pop();
		var root = url.replaceAll(page, '');
		
		//replace all instance of relative path with the atcual url path
		data = data.replaceAll('./', root);

		let container = document.getElementById('parent');

		//create div element
		let element = document.createElement('div');
			
		var modPreviewHtml =	`<div class="child">
									<div class="childImageContainer">
										<div class="fill" style="background-image: url('ModThumbnailUrl');"></div>
									</div>
									<div class="childTextContainer">
										<h5>ModName</h5>
										<p>ModDescription</p>
									</div>
								</div>`;
		element.innerHTML = modPreviewHtml;

		element.style.cursor = 'pointer';
			element.onclick = function() {
				element.innerHTML = '';
			};

		container.appendChild(element);
	}

	async function anAsyncFunc(url) {
		let response = await fetch(url);
		let data = await response.text();

		//figure out the root path
		let page = url.split('/').pop();
		var root = url.replaceAll(page, '');
		
		//replace all instance of relative path with the atcual url path
		data = data.replaceAll('./', root);

		var iframe = document.createElement('iframe');

		// div tag in which iframe will be added should have id attribute with value myDIV
		document.getElementById("parent").appendChild(iframe);

		// provide height and width to it
		iframe.setAttribute("height","100%");
		iframe.setAttribute("width","100%");
		iframe.setAttribute("class", "child");
		iframe.contentWindow.document.open();
		iframe.contentWindow.document.write(data);
		iframe.contentWindow.document.close();

		iframe.style.cursor = 'pointer';
		iframe.onclick = function() {
		console.log('iframe clicked');
		// Expected output: "resolved"
		}
	}

</script>

